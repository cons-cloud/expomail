# ğŸ’¾ Base de DonnÃ©es HyperEmail

## ğŸ”¥ Supabase Supabase IntÃ©grÃ© !

HyperEmail utilise maintenant **Supabase Supabase** comme base de donnÃ©es.

---

## ğŸ“Š Architecture Actuelle

### **Mode Hybride : MÃ©moire + Supabase**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         APPLICATION                 â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   MÃ‰MOIRE    â”‚  â”‚   FIREBASE  â”‚ â”‚
â”‚  â”‚   (RAM)      â”‚â—„â”€â”¤  FIRESTORE  â”‚ â”‚
â”‚  â”‚              â”‚  â”‚             â”‚ â”‚
â”‚  â”‚  â€¢ Rapide    â”‚  â”‚ â€¢ Permanent â”‚ â”‚
â”‚  â”‚  â€¢ Volatile  â”‚  â”‚ â€¢ Scalable  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ… FonctionnalitÃ©s

### **1. Sauvegarde Automatique**

Chaque email scrapÃ© est automatiquement sauvegardÃ© dans Supabase :

```javascript
// Lors du scraping
emailData = {
    email: "mairie@paris.fr",
    name: "Mairie de Paris",
    city: "Paris",
    source: "https://...",
    date: new Date(),
    sent: false,
    category: "mairies"
};

// Sauvegarde automatique dans Supabase
saveEmailToSupabase(emailData, category);
```

### **2. Chargement au DÃ©marrage**

Au dÃ©marrage du serveur, les donnÃ©es sont chargÃ©es depuis Supabase :

```
ğŸ“¦ Chargement depuis Supabase...
âœ… DonnÃ©es Supabase chargÃ©es
ğŸ“§ mairies: 150 emails
ğŸ“§ justice: 75 emails
```

### **3. Synchronisation en Temps RÃ©el**

- âœ… **Scraping** â†’ Sauvegarde dans Supabase
- âœ… **Envoi** â†’ Mise Ã  jour du statut
- âœ… **Suppression** â†’ Suppression dans Supabase

---

## ğŸ”§ Configuration

### **Ã‰tape 1 : Obtenir les Credentials**

1. Allez sur https://console.firebase.google.com
2. Projet : **hyperemail-a5e30**
3. ParamÃ¨tres â†’ Comptes de service
4. GÃ©nÃ©rer une nouvelle clÃ© privÃ©e
5. TÃ©lÃ©charger le fichier JSON

### **Ã‰tape 2 : Installer le Fichier**

```bash
# Renommer le fichier tÃ©lÃ©chargÃ©
mv ~/Downloads/hyperemail-a5e30-*.json supabase.js

# Le placer dans le dossier HyperEmail
cp supabase.js /Users/jamilaaitbouchnani/Downloads/HyperEmail-main/
```

### **Ã‰tape 3 : RedÃ©marrer**

```bash
npm start
```

**RÃ©sultat attendu :**
```
âœ… Supabase initialisÃ© avec le fichier de configuration
âœ… Supabase connectÃ©
ğŸ“¦ Chargement depuis Supabase...
âœ… DonnÃ©es Supabase chargÃ©es
```

---

## ğŸ“¦ Structure des DonnÃ©es

### **Collection Supabase : `emails`**

```javascript
Document ID: "mairies_mairie@paris.fr"
{
  email: "mairie@paris.fr",
  name: "Mairie de Paris",
  city: "Paris",
  source: "https://www.annuaire-mairie.fr",
  date: Timestamp(2025-10-26 10:00:00),
  sent: false,
  sentAt: null,
  category: "mairies",
  updatedAt: Timestamp(2025-10-26 10:00:00)
}
```

---

## ğŸš€ Avantages

### **Avec Supabase (RecommandÃ©)**

| FonctionnalitÃ© | Status |
|----------------|--------|
| **DonnÃ©es permanentes** | âœ… |
| **Survit au redÃ©marrage** | âœ… |
| **CapacitÃ© illimitÃ©e** | âœ… |
| **Synchronisation auto** | âœ… |
| **Backup automatique** | âœ… |
| **Scalable** | âœ… |

### **Sans Supabase (Mode MÃ©moire)**

| FonctionnalitÃ© | Status |
|----------------|--------|
| **DonnÃ©es permanentes** | âŒ |
| **Survit au redÃ©marrage** | âŒ |
| **CapacitÃ©** | 200 000 max |
| **Synchronisation auto** | N/A |
| **Backup automatique** | âŒ |
| **Scalable** | âš ï¸ LimitÃ© |

---

## ğŸ”„ Mode de Fonctionnement

### **Si Supabase est ConfigurÃ©**

1. **DÃ©marrage** : Charge les donnÃ©es depuis Supabase
2. **Scraping** : Sauvegarde dans RAM + Supabase
3. **Envoi** : Met Ã  jour RAM + Supabase
4. **RedÃ©marrage** : RÃ©cupÃ¨re tout depuis Supabase

### **Si Supabase N'est PAS ConfigurÃ©**

1. **DÃ©marrage** : DÃ©marre avec mÃ©moire vide
2. **Scraping** : Sauvegarde en RAM uniquement
3. **Envoi** : Met Ã  jour la RAM uniquement
4. **RedÃ©marrage** : Perd toutes les donnÃ©es

**L'application fonctionne dans les deux cas !**

---

## ğŸ“Š CapacitÃ©s

### **Limites Supabase Supabase**

| MÃ©trique | Gratuit | Payant |
|----------|---------|--------|
| **Stockage** | 1 GB | IllimitÃ© |
| **Lectures/jour** | 50 000 | IllimitÃ© |
| **Ã‰critures/jour** | 20 000 | IllimitÃ© |
| **Suppressions/jour** | 20 000 | IllimitÃ© |

**Pour HyperEmail :**
- âœ… 200 000 emails = ~50 MB
- âœ… Largement dans les limites gratuites

---

## ğŸ›¡ï¸ SÃ©curitÃ©

### **Fichier supabase.js**

âš ï¸ **CRITIQUE** : Ne partagez JAMAIS ce fichier !

- âœ… AjoutÃ© dans `.gitignore`
- âœ… Contient des clÃ©s privÃ©es
- âœ… AccÃ¨s complet Ã  votre Supabase

### **RÃ¨gles Supabase**

Actuellement : AccÃ¨s ouvert (dÃ©veloppement)

**Pour la production, sÃ©curisez :**

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /emails/{emailId} {
      // Seulement depuis le backend authentifiÃ©
      allow read, write: if request.auth != null;
    }
  }
}
```

---

## ğŸ“¥ Export des DonnÃ©es

### **Depuis l'Application**

Bouton "ğŸ“¥ TÃ©lÃ©charger CSV/Excel" :
- Exporte depuis la mÃ©moire (rapide)
- Format CSV compatible Excel

### **Depuis Supabase Console**

1. Console Supabase â†’ Supabase
2. SÃ©lectionnez la collection `emails`
3. Export â†’ Cloud Storage

---

## ğŸ” Monitoring

### **Console Supabase**

https://console.firebase.google.com/project/hyperemail-a5e30

**Vous pouvez voir :**
- Nombre de documents
- Taille de la base
- Nombre de lectures/Ã©critures
- CoÃ»ts (si dÃ©passement gratuit)

---

## âœ… Status Actuel

**Configuration :**
- âœ… Supabase Admin SDK installÃ©
- âœ… Code d'intÃ©gration ajoutÃ©
- âš ï¸ Credentials Ã  configurer (fichier JSON)

**Fonctionnement :**
- âœ… Mode hybride actif
- âœ… Fallback sur mÃ©moire si Supabase indisponible
- âœ… Aucune erreur bloquante

**Pour activer Supabase :**
1. TÃ©lÃ©chargez le fichier JSON depuis Supabase Console
2. Renommez-le en `supabase.js`
3. Placez-le dans le dossier racine
4. RedÃ©marrez : `npm start`

---

## ğŸ“– Documentation

Consultez **FIREBASE_SETUP.md** pour le guide complet de configuration.

---

Â© 2025 **Maroc Gestion Entreprendre** - Tous droits rÃ©servÃ©s
